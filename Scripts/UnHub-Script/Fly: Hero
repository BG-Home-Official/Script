local tpHero, flyingHero, flyHero = false, false, false
local TweenService = game:GetService("TweenService")  
local speedsHero = 5
local notMoving = false
local loadanim
local heartbeatConnection = nil
local flyMoveConn = nil
local IsNoFlyFast = false
local plr = game.Players.LocalPlayer
local Camera = game.Workspace.Camera
local R6
local anim

local function PlayAnim(id, time, speed)
    local chr = plr.Character
    local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
    pcall(function()
        chr.Animate.Disabled = false
        for _, track in pairs(hum:GetPlayingAnimationTracks()) do
            track:Stop()
        end
        chr.Animate.Disabled = true
        local anim = Instance.new("Animation")
        anim.AnimationId = "rbxassetid://" .. id
        loadanim = hum:LoadAnimation(anim)
        loadanim:Play(2, 5, 10)
        loadanim.TimePosition = time
        loadanim:AdjustSpeed(speed)
        loadanim.Stopped:Connect(function()
            chr.Animate.Disabled = false
        end)
    end)
end

function FlyHero()
    local chr = plr.Character
    local hum = chr and chr:FindFirstChildWhichIsA("Humanoid")
    if not chr or not hum then return end
    
    notMoving = true
    flyHero, flyingHero, tpHero = true, true, true

    local Torso = chr:FindFirstChild("UpperTorso") or chr:FindFirstChild("Torso")
    
    local flyBV = Instance.new("BodyVelocity", Torso)
    flyBV.Velocity = Vector3.new(0, 0.1, 0)
    flyBV.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    flyBV.Name = "flyBVHero"
    
	task.spawn(function()
		while flyHero do
			flyBV.Velocity = Vector3.new(0, 1, 0)
			task.wait(2)
			flyBV.Velocity = Vector3.new(0, -1, 0)
			task.wait(2)
		end
	end)

    local bg = Instance.new("BodyGyro", Torso)
    bg.P = speedsHero > 3 and 9999 or 9999999
    bg.MaxTorque = Vector3.new(5e9, 5e9, 5e9)
    bg.CFrame = Torso.CFrame
    
    chr.Animate.Disabled = true
    
    if hum.RigType == Enum.HumanoidRigType.R6 then
        PlayAnim(429730430, 4.95, 0)
        anim = game:GetService("RunService").Heartbeat:Connect(function()
        	if tpHero and hum then
        		local moving = hum.MoveDirection.Magnitude > 0
        		if moving and notMoving then
        			notMoving = false
        			if speedsHero > 3 then
        				IsNoFlyFast = false
						for _, track in pairs(hum:GetPlayingAnimationTracks()) do
						        track:Stop()
						    end
						wait()
	        			PlayAnim(90872539, 1, 0)
	        			local bg = Torso:FindFirstChildOfClass("BodyGyro")
	        			if bg then bg:Destroy() end
	                	TweenService:Create(Camera, TweenInfo.new(0.5), {FieldOfView = 110}):Play() 
	                else
	                	local bg = Torso:FindFirstChildOfClass("BodyGyro")
	                	bg.P = 9999999
	                	IsNoFlyFast = true
	                end
        		elseif not moving and not notMoving then
        			notMoving = true
					for _, track in pairs(hum:GetPlayingAnimationTracks()) do
					        track:Stop()
					    end
					wait()
        			PlayAnim(429730430, 4.95, 0)
                	TweenService:Create(Camera, TweenInfo.new(0.5), {FieldOfView = 70}):Play()
                	local bg = Torso:FindFirstChildOfClass("BodyGyro")
	                bg.P = 9999
        		end
        	end
        end)
    elseif hum.RigType == Enum.HumanoidRigType.R15 then
        PlayAnim(10714347256, 4.65, 0)
        anim = game:GetService("RunService").Heartbeat:Connect(function()
        	if tpHero and hum then
        		local moving = hum.MoveDirection.Magnitude > 0
        		if moving and notMoving then
        			notMoving = false
        			if speedsHero > 3 then
        				IsNoFlyFast = false
						for _, track in pairs(hum:GetPlayingAnimationTracks()) do
						        track:Stop()
						    end
						wait()
	        			PlayAnim(10714177846, 4.65, 0)
	        			local bg = Torso:FindFirstChildOfClass("BodyGyro")
	        			if bg then bg:Destroy() end
	                	TweenService:Create(Camera, TweenInfo.new(0.5), {FieldOfView = 110}):Play()
	                else
	                	local bg = Torso:FindFirstChildOfClass("BodyGyro")
	                	bg.P = 9999999
	                	IsNoFlyFast = true
                	end
        		elseif not moving and not notMoving then
        			notMoving = true
					for _, track in pairs(hum:GetPlayingAnimationTracks()) do
					        track:Stop()
					    end
					wait()
        			PlayAnim(10714347256, 4.65, 0)
                	TweenService:Create(Camera, TweenInfo.new(0.5), {FieldOfView = 70}):Play()
                	local bg = Torso:FindFirstChildOfClass("BodyGyro")
	                bg.P = 9999
        		end
        	end
        end)
    end
    flyMoveConn = game:GetService("RunService").Heartbeat:Connect(function()
        if tpHero and hum then
            if hum.MoveDirection.Magnitude > 0 then
            	chr:TranslateBy(hum.MoveDirection * speedsHero * 0.3)
            end
        end
    end)
    
    for _, track in pairs(hum:GetPlayingAnimationTracks()) do
        track:AdjustSpeed(0)
    end
    
    for _, state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
        pcall(function() hum:SetStateEnabled(state, false) end)
    end

    hum:SetStateEnabled(Enum.HumanoidStateType.Flying, true)
    hum:ChangeState(Enum.HumanoidStateType.Swimming)
    
    heartbeatConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if (notMoving and flyingHero) or (speedsHero < 4 and flyingHero) then
            local Torso = chr:FindFirstChild("UpperTorso") or chr:FindFirstChild("Torso")
            if not Torso then return end
            local currentBG = Torso:FindFirstChildOfClass("BodyGyro")
            if not currentBG then
                currentBG = Instance.new("BodyGyro")
                currentBG.P = 9999
                currentBG.MaxTorque = Vector3.new(5e9, 5e9, 5e9)
                currentBG.CFrame = Torso.CFrame
                currentBG.Parent = Torso
            end
            
            currentBG.CFrame = Camera.CFrame
        end
    end)
end

function unFlyHero()
    local TweenService = game:GetService("TweenService")  
    TweenService:Create(Camera, TweenInfo.new(0.5), {FieldOfView = 70}):Play()  
    if heartbeatConnection then
        heartbeatConnection:Disconnect()
        heartbeatConnection = nil
    end
    if flyMoveConn then
        flyMoveConn:Disconnect()
        flyMoveConn = nil
    end
    if anim then
        anim:Disconnect()
        anim = nil
    end
    notMoving = false
    wait()
    if loadanim then loadanim:Stop() end
    flyHero, flyingHero, tpHero = false, false, false

    local chr = plr.Character
    if not chr then return end
    local hum = chr:FindFirstChildWhichIsA("Humanoid")
    local Torso = chr:FindFirstChild("UpperTorso") or chr:FindFirstChild("Torso")

    if hum then
        for _, state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
            pcall(function() hum:SetStateEnabled(state, true) end)
        end
        hum:ChangeState(Enum.HumanoidStateType.Running)
    end

    if Torso then
        wait()
        local bv = Torso:FindFirstChild("flyBVHero")
        if bv then bv:Destroy() end
        local bg = Torso:FindFirstChildOfClass("BodyGyro")
        if bg then bg:Destroy() end
        local a = Torso:FindFirstChild("A")
        if a then a:Destroy() end
    end

    local animateScript = chr:FindFirstChild("Animate")
    if animateScript then
        animateScript.Disabled = false
    end
end

function updata()
    local chr = plr.Character
    local Torso = chr:FindFirstChild("UpperTorso") or chr:FindFirstChild("Torso")
    local hum = chr:FindFirstChildWhichIsA("Humanoid")
    if flyMoveConn then
        flyMoveConn:Disconnect()
        flyMoveConn = nil
    end

    flyMoveConn = game:GetService("RunService").Heartbeat:Connect(function()
        if chr and hum then
            chr:TranslateBy(hum.MoveDirection * speedsHero * 0.3)
        end
    end)
    if not notMoving  then
    	if speedsHero > 3 and IsNoFlyFast then
    		IsNoFlyFast = false
			for _, track in pairs(hum:GetPlayingAnimationTracks()) do
				if track.Animation.AnimationId ~= "rbxassetid://90872539" or track.Animation.AnimationId ~= "rbxassetid://10714177846" then
					track:Stop()
				end
			end
			wait()
			if hum.RigType == Enum.HumanoidRigType.R6 then
				PlayAnim(90872539, 1, 0)
			else
				PlayAnim(10714177846, 4.65, 0)
			end
	        local bg = Torso:FindFirstChildOfClass("BodyGyro")
	        if bg then bg:Destroy() end
	        TweenService:Create(Camera, TweenInfo.new(0.5), {FieldOfView = 110}):Play()
    	elseif speedsHero < 4 and not IsNoFlyFast then
    		IsNoFlyFast = true
    		for _, track in pairs(hum:GetPlayingAnimationTracks()) do
				if track.Animation.AnimationId ~= "rbxassetid://429730430" or track.Animation.AnimationId ~= "rbxassetid://10714347256" then
					track:Stop()
				end
			end
			wait()
			if hum.RigType == Enum.HumanoidRigType.R6 then
				PlayAnim(429730430, 4.95, 0)
			else
				PlayAnim(10714347256, 4.65, 0)
			end
            TweenService:Create(Camera, TweenInfo.new(0.5), {FieldOfView = 70}):Play()
        	local bg = Torso:FindFirstChildOfClass("BodyGyro")
	        bg.P = 9999999
    	end
    end
end

plr.Character:WaitForChild("Humanoid").Died:Connect(function()
    if flyHero then unFlyHero() end
end)

local S = Instance.new("ScreenGui", game.CoreGui)
S.Name = "Fly Hero"

local F = Instance.new("Frame", S)
F.Size = UDim2.new(0, 230, 0, 130)
F.Position = UDim2.new(0, 230, 0, 100)
F.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
F.Active = true
F.Draggable = true
F.BorderSizePixel = 3
F.BorderColor3 = Color3.fromRGB(0, 0, 0)

local T = Instance.new("TextButton", F)
T.Size = UDim2.new(0, 180, 0, 50)
T.Position = UDim2.new(0, 23, 0, 15)
T.BackgroundColor3 = Color3.fromRGB(255, 200, 255)
T.BorderSizePixel = 2
T.BorderColor3 = Color3.fromRGB(0, 0, 0)
T.TextScaled = true
T.Font = Enum.Font.SciFi
T.Text = speedsHero

local B = Instance.new("TextButton", F)
B.Size = UDim2.new(0, 48, 0, 30)
B.Position = UDim2.new(0, 23, 0, 85)
B.BackgroundColor3 = Color3.fromRGB(255, 200, 255)
B.BorderSizePixel = 2
B.BorderColor3 = Color3.fromRGB(0, 0, 0)
B.TextScaled = true
B.Text = "+"
B.Font = Enum.Font.SciFi
B.MouseButton1Click:Connect(function()
    speedsHero = speedsHero + 1
    T.Text = speedsHero
    if flyingHero then
        updata()
    end
end)

local B2 = Instance.new("TextButton", F)
B2.TextScaled = true
B2.Font = Enum.Font.SciFi
B2.Size = UDim2.new(0, 48, 0, 30)
B2.Position = UDim2.new(0, 155, 0, 85)
B2.BackgroundColor3 = Color3.fromRGB(255, 200, 255)
B2.BorderSizePixel = 2
B2.BorderColor3 = Color3.fromRGB(0, 0, 0)
B2.Text = "-"
B2.MouseButton1Click:Connect(function()
    if speedsHero > 1 then
        speedsHero = speedsHero - 1
        T.Text = speedsHero
        if flyingHero then
            updata()
        end
    end
end)

local B3Fly = Instance.new("TextButton", F)
B3Fly.TextScaled = true
B3Fly.Font = Enum.Font.SciFi
B3Fly.Size = UDim2.new(0, 48, 0, 30)
B3Fly.Position = UDim2.new(0, 90, 0, 85)
B3Fly.BackgroundColor3 = Color3.fromRGB(255, 200, 255)
B3Fly.BorderSizePixel = 2
B3Fly.BorderColor3 = Color3.fromRGB(0, 0, 0)
B3Fly.Text = "Fly"
B3Fly.MouseButton1Click:Connect(function()
    if flyHero then
        unFlyHero()
    else
        FlyHero()
    end
end)

local B3Close = Instance.new("TextButton", F)
B3Close.Font = Enum.Font.ArimoBold
B3Close.Size = UDim2.new(0, 48, 0, 30)
B3Close.Position = UDim2.new(0, 190, 0, -5)
B3Close.Text = "X"
B3Close.TextSize = 15
B3Close.BackgroundTransparency = 1
B3Close.MouseButton1Click:Connect(function()
    S:Destroy()
    unFlyHero()
end)
